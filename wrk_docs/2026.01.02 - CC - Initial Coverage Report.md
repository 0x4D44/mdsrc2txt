# Code Coverage Report - 2026.01.02

## Overview
This report analyzes the current code coverage of the `mdsrc2txt` project. The analysis is based on `cargo llvm-cov` output.

## Summary
- **Overall Coverage:** Low (Estimated < 40% of logic lines).
- **Tested Components:**
    - `is_source_file` (Helper function only used in tests).
    - `write_file_content` (Partially, via `test_process_directory`).
    - `test_process_directory` (Test function).
    - `test_process_zip` (Test function).
- **Untested Components:**
    - `main` function (Entry point, CLI parsing, orchestration).
    - `format_size` (Formatting utility).
    - `format_filename` (Formatting utility).
    - Logic within `main` for file processing (duplicated in tests instead of reused).

## Detailed Findings

### 1. `main` Function (0% Coverage)
The `main` function is completely untested. This includes:
- **CLI Argument Parsing:** `clap` configuration and parsing are not verified.
- **Path Validation:** Checks for file existence and type (dir/file) are not tested.
- **Output File Creation:** Logic for naming and creating the output file is unverified.
- **Core Loop:** The actual traversal of directories and ZIP files used in production is distinct from the logic in the tests. The tests verify *similar* logic but not the *actual* code in `main`.

### 2. Utility Functions
- **`format_size` (0% Coverage):** The logic for formatting byte counts (B, KB, MB, GB) is not tested.
- **`format_filename` (0% Coverage):** The truncation logic for filenames is not tested.
- **`write_file_content` (Covered):** This function is used in `test_process_directory` and thus has coverage.

### 3. Code Duplication
There is significant code duplication between `main` and the test suite:
- **Extension Filtering:** `main` defines `allowed_exts` inline. Tests define it again. `is_source_file` is defined in tests but not used in `main`.
- **Zip Processing:** `main` has a zip processing loop. `test_process_zip` implements its own loop rather than calling the one in `main`.
- **Directory Processing:** Similar duplication for directory walking.

## Recommendations
To improve coverage and maintainability:
1.  **Refactor `main`:** Extract the core logic into a testable function (e.g., `run(config: Config) -> Result<()>`).
2.  **Unify Logic:** Move `is_source_file` and `allowed_exts` to the main module and use them in both `main` and tests.
3.  **Test Utilities:** Add unit tests for `format_size` and `format_filename`.
4.  **Integration Tests:** Test the `run` function with temporary directories/files to verify the actual production code paths.
