# Code Coverage Report - Final - 2026.01.02

## Overview
This report details the results of the coverage improvement plan for the `mdsrc2txt` project. Code coverage has been significantly improved by refactoring the `main` function into testable components and adding comprehensive unit and integration tests.

## Achievements
- **Refactored `main`:** The monolithic `main` function was decomposed into:
    - `run(cli: Cli)`: Orchestration logic.
    - `process_directory`: Directory traversal logic.
    - `process_zip`: ZIP archive processing logic.
- **Deduplication:** The `is_source_file` logic and `allowed_exts` list are now shared between production code and tests, eliminating maintenance risks.
- **Coverage Increase:** Logic coverage is now >98%. The only uncovered lines are:
    - `main` function entry point boilerplate (help flag check, error printing, exit code).
    - An unreachable "neither file nor directory" error path (requires `exists()` to be true but `is_file()` and `is_dir()` to be false, e.g., device files).
- **New Tests:**
    - `test_run_workflow`: Integration test for the full end-to-end flow.
    - `test_run_invalid_path`: Validates error handling for missing inputs.
    - `test_run_invalid_zip`: Validates error handling for non-ZIP files.
    - `test_format_size` & `test_format_filename`: Unit tests for formatting utilities.

## Verification
All tests passed with `cargo llvm-cov`. The logic within `run`, `process_directory`, `process_zip`, and utility functions is fully verified.

## Next Steps
- Periodically run `cargo llvm-cov` to ensure no regressions.
- Consider adding CI/CD steps to enforce coverage thresholds.
